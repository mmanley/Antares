# This file defines the optional packages that can be added to the Antares image.
# It is directly included from AntaresImage -- all variables defined there can
# be used

# Detect a hybrid GCC2/GCC4 image and disable the checks for unavailable GCC4
# packages. (It does not matter if a package was built with either compiler,
# the system should have the respective other system libs.)
local isHybridBuild ;
if $(ANTARES_ADD_ALTERNATIVE_GCC_LIBS) && $(ANTARES_ALTERNATIVE_GCC_OUTPUT_DIR) {
	isHybridBuild = 1 ;
}


# Available Optional Packages:
#	ABI-compliance-checker	- tool for checking ABI compatibility between libs
#	APR						- support libraries used for example by Subversion
#	APR-util				- Apache portable runtime utility library
#	BasicCommandLineTools	- basic commandline tools
#	Beam					- powerful native e-mail client
#	BeBook					- the classic BeOS API documentation
#	BeHappy					- special documentation (i.e. BeBook) browser
#	BeOSCompatibility		- creates links within the system to support old apps
#	BePDF					- native PDF reader
#	BeZillaBrowser			- fork of Mozilla's 1.8 branch.
#	Bluetooth				- experimental Antares components for Bluetooth
#	CDRecord				- the command line CD writing tools
#	Clockwerk				- native audio/video compositing
#	CLucene					- indexed file search
#	Curl					- a client that groks URLs
#	CMake					- cross platform make
#	CVS						- the version control system
#	Development				- more complete dev environment (including autotools)
#	DevelopmentBase			- basic development environment (gcc, headers, libs,...)
#	DevelopmentMin			- development headers, libs, tools, from sources only
#	Expat					- XML parsing libraries
#	Firefox					- the webbrowser NOTE: will be removed soon.
#	Git						- the distributed version control system
#	ICU-devel				- the headers for ICU (for development)
#	KeymapSwitcher			- Desktop utility
#	LibIconv				- text encoding conversion library
#	LibLayout				- GCC2 package needed by some BeOS apps to compile
#	LibXML2					- the XML support libary
#	Links					- the web browser
#	Mercurial				- the distributed version control system
#	Nano					- the command line text editor
#	Neon					- support libraries used for example by SVN
#	NetFS					- the native networked file system components
#	NetSurf					- the web browser
#	OCaml					- the Objective Caml language
#	OpenSound				- additional audio driver package
#	OpenSSH					- the secure shell
#	OpenSSL					- secure sockets library
#	P7zip					- file archiving utility
#	PCRE					- the (Perl-compatible) regex engine
#	Pe						- the powerful native Programmer's Editor
#	Perl					- the scripting language
#	Python					- the scripting language
#	Rsync					- remote directory synchronization
#	SQLite					- the database implementation
#	Subversion				- the version control system
#	Tar						- archiving utility
#	UserlandFS				- aids native file system development (like FUSE)
#	Vim						- the command line text editor
#	Vision					- powerful native IRC client
#	VLC						- the multi media player with native interface
#	Welcome					- introductory documentation to Antares
#	WifiFirmwareScriptData	- data files needed by install-wifi-firmwares.sh
#	WonderBrush				- native graphics application
#	Yasm					- the assembler utility

local baseURL = http://antares-files.org/files/optional-packages ;

# ABI-compliance-checker
if [ IsOptionalAntaresImagePackageAdded ABI-compliance-checker ] {
	if $(ANTARES_GCC_VERSION[1]) < 4 && ! $(isHybridBuild) {
		Echo "No optional package ABI-compliance-checker for gcc2" ;
	} else {
		InstallOptionalAntaresImagePackage
			ABI-compliance-checker-1.12-noarch-gcc4-2010-02-01.zip
			: $(baseURL)/ABI-compliance-checker-1.12-noarch-gcc4-2010-02-01.zip
		;
	}
}


# APR
if [ IsOptionalAntaresImagePackageAdded APR ] {
	if $(TARGET_ARCH) != x86 {
		Echo "No optional package APR available for $(TARGET_ARCH)" ;
	} else {
		InstallOptionalAntaresImagePackage apr-1.3.9-x86-gcc2-2009-10-18.zip
			: $(baseURL)/apr-1.3.9-x86-gcc2-2009-10-18.zip
			:
			: true
		;
	}
}


# APR-util
if [ IsOptionalAntaresImagePackageAdded APR-util ] {
	if $(TARGET_ARCH) != x86 {
		Echo "No optional package APR-util available for $(TARGET_ARCH)" ;
	} else {
		InstallOptionalAntaresImagePackage apr-util-1.3.9-r1a1-x86-gcc2-2009-08-29.zip
			: $(baseURL)/apr-util-1.3.9-r1a1-x86-gcc2-2009-08-29.zip
			:
			: true
		;
	}
}


# BasicCommandLineTools
if [ IsOptionalAntaresImagePackageAdded BasicCommandLineTools ] {
	if $(TARGET_ARCH) != x86 {
		Echo "No optional package BasicCommandLineTools available for $(TARGET_ARCH)" ;
	} else {
		# sed
		InstallOptionalAntaresImagePackage sed-4.2.1-r1a1-x86-gcc2-2009-08-30.zip
			: $(baseURL)/sed-4.2.1-r1a1-x86-gcc2-2009-08-30.zip
			:
			: true ;
	}
}


# Beam
if [ IsOptionalAntaresImagePackageAdded Beam ] {
	if $(TARGET_ARCH) != x86 {
		Echo "No optional package Beam available for $(TARGET_ARCH)" ;
	} else if $(ANTARES_GCC_VERSION[1]) >= 4 && ! $(isHybridBuild) {
		Echo "No optional package Beam available for gcc4" ;
	} else {
		InstallOptionalAntaresImagePackage Beam-1.2alpha.zip
			: $(baseURL)/Beam-1.2alpha-x86-gcc2-2009-09-29.zip
			: apps
		;
		AddSymlinkToAntaresImage home config be Applications
			: /boot/apps/beam-1.2alpha-antares/Beam ;
	}
}


# BeBook
if [ IsOptionalAntaresImagePackageAdded BeBook ] {
	InstallOptionalAntaresImagePackage bebook_20081026.zip
		: $(baseURL)/bebook_20081026.zip
		: system documentation
	;
	AddSymlinkToAntaresImage home Desktop
		: /boot/system/documentation/bebook/index.html : BeBook ;
}


# BeHappy
if [ IsOptionalAntaresImagePackageAdded BeHappy ] {
	if $(TARGET_ARCH) != x86 {
		Echo "No optional package BeHappy available for $(TARGET_ARCH)" ;
	} else if $(ANTARES_GCC_VERSION[1]) >= 4 && ! $(isHybridBuild) {
		Echo "No optional package BeHappy available for gcc4" ;
	} else {
		InstallOptionalAntaresImagePackage BeHappy-1.0.6-x86-gcc2-2008-10-16.zip
			: $(baseURL)/BeHappy-1.0.6-x86-gcc2-2008-10-16.zip
			:
		;
		AddSymlinkToAntaresImage home config be Applications
			: /boot/apps/BeHappy/BeHappy ;
	}
}


# BeOSCompatibility
if [ IsOptionalAntaresImagePackageAdded BeOSCompatibility ] {
	if $(TARGET_ARCH) != x86 {
		Echo "No optional package BeOSCompatibility available for $(TARGET_ARCH)" ;
	} else if $(ANTARES_GCC_VERSION[1]) >= 4 && ! $(isHybridBuild) {
		Echo "No optional package BeOSCompatibility available for gcc4" ;
	} else {
		Echo "Warning: Adding BeOS compatibility symlinks. This will go away. Please fix your apps!" ;
		AddSymlinkToAntaresImage beos : ../system/apps ;
		AddSymlinkToAntaresImage beos : ../system/bin ;
		AddSymlinkToAntaresImage beos : ../system/documentation ;
		AddSymlinkToAntaresImage beos : ../common/etc ;
		AddSymlinkToAntaresImage beos : ../system/preferences ;
		AddSymlinkToAntaresImage beos : ../system ;
		AddDirectoryToAntaresImage var ;
		AddSymlinkToAntaresImage var : /boot/common/var/log ;
		AddSymlinkToAntaresImage var : /boot/common/cache/tmp ;
	}
}


# BePDF
if [ IsOptionalAntaresImagePackageAdded BePDF ] {
	if $(TARGET_ARCH) != x86 {
		Echo "No optional package BePDF available for $(TARGET_ARCH)" ;
	} else if $(ANTARES_GCC_VERSION[1]) >= 4 && ! $(isHybridBuild) {
		Echo "No optional package BePDF available for gcc4" ;
	} else {
		InstallOptionalAntaresImagePackage BePDF-1.1.1b2-r1a1-x86-gcc2-2009-09-03.zip
			: $(baseURL)/BePDF-1.1.1b2-r1a1-x86-gcc2-2009-09-03.zip
			: apps
		;
		AddSymlinkToAntaresImage home config be Applications
			: /boot/apps/BePDF/BePDF ;
	}
}


# BeZillaBrowser
if [ IsOptionalAntaresImagePackageAdded BeZillaBrowser ] {
	if $(TARGET_ARCH) != x86 {
		Echo "No optional package BeZillaBrowser available for $(TARGET_ARCH)" ;
	} else if $(ANTARES_GCC_VERSION[1]) >= 4 {
		InstallOptionalAntaresImagePackage
			BeZillaBrowser-2.0.0.22pre-x86-gcc4-2010-01-27.zip
			: $(baseURL)/BeZillaBrowser-2.0.0.22pre-x86-gcc4-2010-01-27.zip
 			:
 		;
 		AddSymlinkToAntaresImage home config be Applications
			: /boot/apps/BeZillaBrowser/BeZillaBrowser ;
	} else {
		InstallOptionalAntaresImagePackage
			BeZillaBrowser-2.0.0.22pre-x86-gcc2-2010-01-27.zip
			: $(baseURL)/BeZillaBrowser-2.0.0.22pre-x86-gcc2-2010-01-27.zip
 			:
 		;
 		AddSymlinkToAntaresImage home config be Applications
			: /boot/apps/BeZillaBrowser/BeZillaBrowser ;
	}
}


# Bluetooth stack
if [ IsOptionalAntaresImagePackageAdded Bluetooth ] {
	local bluetoothDrivers = h2generic ;
	AddDriversToAntaresImage bluetooth : $(bluetoothDrivers) ;
	AddFilesToAntaresImage system servers : bluetooth_server ;
	AddFilesToAntaresImage system lib : libbluetooth.so ;
	AddFilesToAntaresImage system add-ons kernel network protocols : l2cap ;
	AddFilesToAntaresImage system add-ons kernel bluetooth : btCoreData hci ;
	AddFilesToAntaresImage system preferences : Bluetooth ;
	AddFilesToAntaresImage system bin : bt_dev_info bt_discovery ;
	AddSymlinkToAntaresImage home config be Preferences
		: /boot/system/preferences/Bluetooth ;
	if [ IsOptionalAntaresImagePackageAdded DevelopmentMin ]
		&& $(ANTARES_GCC_VERSION[1]) in 2 4 {
		local arch = $(TARGET_ARCH) ;
		local abi = gcc$(ANTARES_GCC_VERSION[1]) ;
		AddSymlinkToAntaresHybridImage develop abi $(arch) $(abi) lib
			: /system/lib libbluetooth.so : : true ;
	}
}


# Bzip
if [ IsOptionalAntaresImagePackageAdded Bzip ] {
	if $(TARGET_ARCH) != x86 {
		Echo "No optional package Bzip available for $(TARGET_ARCH)" ;
	} else {
		InstallOptionalAntaresImagePackage bzip2-1.0.5-x86-gcc2-2009-12-27.zip
			: $(baseURL)/bzip2-1.0.5-x86-gcc2-2009-12-27.zip
			:
			: true
		;
	}
}


# CDRecord
if [ IsOptionalAntaresImagePackageAdded CDRecord ] {
	if $(TARGET_ARCH) != x86 {
		Echo "No optional package CDRecord available for $(TARGET_ARCH)" ;
	} else {
		InstallOptionalAntaresImagePackage cdrecord-2.01.01a63-r1a1-x86-gcc2-2009-08-28.zip
			: $(baseURL)/cdrecord-2.01.01a63-r1a1-x86-gcc2-2009-08-28.zip
			:
		;
	}
}


# Clockwerk
if [ IsOptionalAntaresImagePackageAdded Clockwerk ] {
	if $(TARGET_ARCH) != x86 {
		Echo "No optional package Clockwerk available for $(TARGET_ARCH)" ;
	} else if $(ANTARES_GCC_VERSION[1]) >= 4 {
		InstallOptionalAntaresImagePackage Clockwerk-0.0.1-x86-gcc4-2009-08-06.zip
			: $(baseURL)/Clockwerk-0.0.1-x86-gcc4-2009-08-06.zip
			:
		;
		AddSymlinkToAntaresImage home config be Applications
			: /boot/apps/Clockwerk/Clockwerk ;
	} else {
		InstallOptionalAntaresImagePackage Clockwerk-0.0.1-x86-gcc2-2009-08-06.zip
			: $(baseURL)/Clockwerk-0.0.1-x86-gcc2-2009-08-06.zip
			:
		;
		AddSymlinkToAntaresImage home config be Applications
			: /boot/apps/Clockwerk/Clockwerk ;
	}
}


# CLucene
if [ IsOptionalAntaresImagePackageAdded CLucene ] {
	if $(TARGET_ARCH) != x86 {
		Echo "No optional package CLucene available for $(TARGET_ARCH)" ;
	} else if $(ANTARES_GCC_VERSION[1]) < 4 && ! $(isHybridBuild) {
		Echo "No optional package CLucene available for GCC2" ;
	} else {
		InstallOptionalAntaresImagePackage
			clucene-0.9.21svn-x86-gcc4-antares-2009-08-11.zip
			: $(baseURL)/clucene-0.9.21-x86-gcc4-antares-2009-08-11.zip
			:
			: true
		;
	}
}


# CMake
if [ IsOptionalAntaresImagePackageAdded CMake ] {
	if $(TARGET_ARCH) != x86 {
		Echo "No optional package CMake available for $(TARGET_ARCH)" ;
	} else {
		InstallOptionalAntaresImagePackage cmake-2.8.0-x86-gcc2-2009-11-15.zip
			: $(baseURL)/cmake-2.8.0-x86-gcc2-2009-11-15.zip
			:
			: true
		;
	}
}


# Curl
if [ IsOptionalAntaresImagePackageAdded Curl ] {
	if $(TARGET_ARCH) != x86 {
		Echo "No optional package Curl available for $(TARGET_ARCH)" ;
	} else {
		InstallOptionalAntaresImagePackage curl-7.20.0-x86-gcc2-2010-03-03.zip
			: $(baseURL)/curl-7.20.0-x86-gcc2-2010-03-03.zip
			:
			: true
		;
	}
}


# CVS
if [ IsOptionalAntaresImagePackageAdded CVS ] {
	if $(TARGET_ARCH) != x86 {
		Echo "No optional package CVS available for $(TARGET_ARCH)" ;
	} else {
		InstallOptionalAntaresImagePackage cvs-1.12.13-r1a1-x86-gcc2-2009-08-30.zip
			: $(baseURL)/cvs-1.12.13-r1a1-x86-gcc2-2009-08-30.zip
			:
			: true
		;
	}
}


# Development
if [ IsOptionalAntaresImagePackageAdded Development ] && $(TARGET_ARCH) = x86 {
	# autotools
	InstallOptionalAntaresImagePackage autoconf-2.65-x86-gcc2-2009-11-28.zip
		: $(baseURL)/autoconf-2.65-x86-gcc2-2009-11-28.zip
		:
		: true ;
	InstallOptionalAntaresImagePackage automake-1.11.1-x86-gcc2-2009-12-23.zip
		: $(baseURL)/automake-1.11.1-x86-gcc2-2009-12-23.zip
		:
		: true ;
	InstallOptionalAntaresImagePackage libtool-2.2.6b-x86-gcc2-2009-11-18.zip
		: $(baseURL)/libtool-2.2.6b-x86-gcc2-2009-11-18.zip
		:
		: true ;
	InstallOptionalAntaresImagePackage texinfo-4.13a-r1a1-x86-gcc2-2009-08-30.zip
		: $(baseURL)/texinfo-4.13a-r1a1-x86-gcc2-2009-08-30.zip
		:
		: true ;
}


# DevelopmentBase
if [ IsOptionalAntaresImagePackageAdded DevelopmentBase ]
		&& $(TARGET_ARCH) = x86 {
	# gcc and binutils
	if $(ANTARES_GCC_VERSION[1]) = 2 || $(isHybridBuild) {
		InstallOptionalAntaresImagePackage gcc-2.95.3-r1a1-x86-gcc2-2009-08-26.zip
			: $(baseURL)/gcc-2.95.3-r1a1-x86-gcc2-2009-08-26.zip ;
	}

	if $(ANTARES_GCC_VERSION[1]) = 4 || $(isHybridBuild) {
		InstallOptionalAntaresImagePackage gcc-4.3.3-r1a1-x86-gcc4-2009-06-29.zip
			: $(baseURL)/gcc-4.3.3-r1a1-x86-gcc4-2009-06-29.zip ;

		# symlink cpp to g++'s headers
		AddSymlinkToAntaresImage develop abi x86 gcc4 headers
			: ../tools/current/include/g++ : cpp ;

		# symlink to the appropriate system/lib[/gcc4] folder
		local libs = libstdc++.so libsupc++.so ;
		for lib in $(libs) {
			AddSymlinkToAntaresHybridImage
				develop abi x86 gcc4 tools gcc-4.3.3-antares-090629 lib
				: /system/lib $(lib) : : true ;
		}
	}

	# other commonly used tools
	InstallOptionalAntaresImagePackage bison-2.4.1-r1a1-x86-gcc2-2009-08-31.zip
		: $(baseURL)/bison-2.4.1-r1a1-x86-gcc2-2009-08-31.zip ;
	InstallOptionalAntaresImagePackage m4-1.4.14-x86-gcc2-2010-02-27.zip
		: $(baseURL)/m4-1.4.14-x86-gcc2-2010-02-27.zip ;
	InstallOptionalAntaresImagePackage flex-2.5.35-r1a1-x86-gcc2-2009-08-31.zip
		: $(baseURL)/flex-2.5.35-r1a1-x86-gcc2-2009-08-31.zip ;
	InstallOptionalAntaresImagePackage jam-2.5-r1a1-x86-gcc2-2009-08-31.zip
		: $(baseURL)/jam-2.5-r1a1-x86-gcc2-2009-08-31.zip ;

}


# DevelopmentMin
if [ IsOptionalAntaresImagePackageAdded DevelopmentMin ] && $(TARGET_ARCH) = x86 {
	if ! ( $(ANTARES_GCC_VERSION[1]) in 2 4 ) {
		Exit "Optional package DevelopmentMin: Unsupported GCC version:"
			$(ANTARES_GCC_VERSION[1]) ;
	}

	local arch = $(TARGET_ARCH) ;
	local abi = gcc$(ANTARES_GCC_VERSION[1]) ;
	local abiDirTokens = develop abi $(arch) $(abi) ;

	# glue code
	AddFilesToAntaresHybridImage $(abiDirTokens) lib :
		<src!system!glue!arch!$(arch)>crti.o
		<src!system!glue!arch!$(arch)>crtn.o
		<src!system!glue>init_term_dyn.o
		<src!system!glue>start_dyn.o
		<src!system!glue>antares_version_glue.o
	;

	# kernel
	AddFilesToAntaresHybridImage $(abiDirTokens) lib : kernel.so : _KERNEL_ ;

	# additional libraries
	local developmentLibs = <revisioned>libroot_debug.so ;
	AddFilesToAntaresHybridImage system lib : $(developmentLibs) : : true ;

	# library symlinks
	local lib ;
	for lib in $(SYSTEM_LIBS) $(SYSTEM_LIBS_LIBGL_ALIASES) $(developmentLibs) {
		AddSymlinkToAntaresHybridImage $(abiDirTokens) lib
			: /system/lib $(lib:BS) : : true ;
		local abiVersion = [ on $(lib) return $(ANTARES_LIB_ABI_VERSION) ] ;
		if $(abiVersion) {
			local abiVersionedLib = $(lib:BS).$(abiVersion) ;
			AddSymlinkToAntaresHybridImage $(abiDirTokens) lib
				: /system/lib $(abiVersionedLib) : : true ;
		}
	}

	# static libraries
	AddFilesToAntaresHybridImage $(abiDirTokens) lib : libncurses.a ;

	# the POSIX error code mapper library
	AddFilesToAntaresHybridImage $(abiDirTokens) lib : libposix_error_mapper.a ;

	# symlinks for ABI abstraction
	AddSymlinkToAntaresImage develop abi : $(arch)/$(abi) : current ;
	AddSymlinkToAntaresImage develop lib : /boot/develop/abi/current/lib
		: $(arch) ;
	AddSymlinkToAntaresImage develop tools
		: /boot/develop/abi/current/tools/current : gnupro ;
	AddSymlinkToAntaresImage develop headers
		: /boot/develop/abi/current/headers/cpp ;
	AddSymlinkToAntaresHybridImage $(abiDirTokens) library-paths
		: /boot/common/lib : common : true ;
	AddSymlinkToAntaresHybridImage $(abiDirTokens) library-paths
		: /boot/home/config/lib : home : true ;

	# ABI independent stuff

	# scripts: cc and c++ wrapper, freetype-config, setgcc
	local scripts = cc c++ freetype-config setgcc ;
	SEARCH on $(scripts) = [ FDirName $(ANTARES_TOP) data bin ] ;
	AddFilesToAntaresImage system bin : $(scripts) ;

	# make and mkdepend build tool, which are part of the Antares source tree
	# TODO: Both should be removed from the tree, made download packages
	# and moved to the DevelopmentBase package.
	AddFilesToAntaresImage system bin : make mkdepend ;

	# skeleton makefile and makefile-engine
	local makefileEngineFiles =
		<makefile-engine>makefile
		<makefile-engine>makefile-engine
	;
	SEARCH on $(makefileEngineFiles)
		= [ FDirName $(ANTARES_TOP) data develop ] ;
	AddFilesToAntaresImage develop etc : $(makefileEngineFiles) ;

	# headers
	AddHeaderDirectoryToAntaresImage config ;
	AddHeaderDirectoryToAntaresImage glibc ;
	AddHeaderDirectoryToAntaresImage os ;
	AddHeaderDirectoryToAntaresImage posix ;

	# create be -> os symlink for now
	AddSymlinkToAntaresImage develop headers : os : be ;

	# BSD and GNU compatibility headers
	AddHeaderDirectoryToAntaresImage compatibility bsd : bsd ;
	AddHeaderDirectoryToAntaresImage compatibility gnu : gnu ;

	# third party libs headers
	AddHeaderDirectoryToAntaresImage libs freetype2 : 3rdparty ;
	AddHeaderDirectoryToAntaresImage libs jpeg : 3rdparty ;
	AddHeaderDirectoryToAntaresImage libs ncurses : 3rdparty ;
	AddHeaderDirectoryToAntaresImage libs png : 3rdparty ;
	AddHeaderDirectoryToAntaresImage libs termcap : 3rdparty ;
	AddHeaderDirectoryToAntaresImage libs zlib : 3rdparty ;

	# cpp headers
	if $(ANTARES_GCC_VERSION[1]) = 2 {
		# GCC 2 only -- for GCC 4 they come with the DevelopmentBase package
		CopyDirectoryToAntaresImage $(abiDirTokens) headers
			: [ FDirName $(ANTARES_TOP) headers cpp ] : : -x .svn ;
		CopyDirectoryToAlternativeGCCArchive $(abiDirTokens) headers
			: [ FDirName $(ANTARES_TOP) headers cpp ] : : -x .svn ;
	}
}


# Expat
if [ IsOptionalAntaresImagePackageAdded Expat ] {
	if $(TARGET_ARCH) != x86 {
		Echo "No optional package Expat available for $(TARGET_ARCH)" ;
	} else {
		InstallOptionalAntaresImagePackage expat-2.0.1-r1a1-x86-gcc2-2009-08-30.zip
			: $(baseURL)/expat-2.0.1-r1a1-x86-gcc2-2009-08-30.zip
			:
			: true
		;
	}
}


# Firefox web browser
if [ IsOptionalAntaresImagePackageAdded Firefox ] {
	Echo "Warning: The optional package Firefox is being replaced with"
	"BeZillaBrowser" ;
}


# Git
if [ IsOptionalAntaresImagePackageAdded Git ] {
	if $(TARGET_ARCH) != x86 {
		Echo "No optional package Git available for $(TARGET_ARCH)" ;
	} else {
		InstallOptionalAntaresImagePackage git-1.6.4.2-r1a1-x86-gcc2-2009-08-30.zip
			: $(baseURL)/git-1.6.4.2-r1a1-x86-gcc2-2009-08-30.zip
			:
			: true
		;
	}
}


# ICU-devel
if [ IsOptionalAntaresImagePackageAdded ICU-devel ] {
	InstallOptionalAntaresImagePackage icu-devel-4.2-2010-01-26.zip
		: $(baseURL)/icu-devel-4.2-2010-01-26.zip
	;
	local arch = $(TARGET_ARCH) ;
	local abi = gcc$(ANTARES_GCC_VERSION[1]) ;
	local libs = common data i18n ;
	for lib in $(libs) {
		lib = libicu-$(lib).so ;
		local abiVersion = [ on $(lib) return $(ANTARES_LIB_ABI_VERSION) ] ;
		if $(abiVersion) {
			local abiVersionedLib = $(lib).$(abiVersion) ;
			AddSymlinkToAntaresHybridImage develop abi $(arch) $(abi) lib
				: /system/lib $(abiVersionedLib) : : true ;
		}
		AddSymlinkToAntaresHybridImage develop abi $(arch) $(abi) lib
			: /system/lib $(lib) : : true ;
	}
}


# KeymapSwitcher
if [ IsOptionalAntaresImagePackageAdded KeymapSwitcher ] {
	if $(TARGET_ARCH) != x86 {
		Echo "No optional package KeymapSwitcher available for $(TARGET_ARCH)" ;
	} else if $(ANTARES_GCC_VERSION[1]) >= 4 {
		InstallOptionalAntaresImagePackage
			KeymapSwitcher-1.2.3-x86-gcc4-2009-05-31.zip
			: $(baseURL)/KeymapSwitcher-1.2.3-x86-gcc4-2009-05-31.zip
			:
		;
		AddSymlinkToAntaresImage home config be Desktop\ applets
			: /boot/common/bin/KeymapSwitcher ;
	} else {
		InstallOptionalAntaresImagePackage
			KeymapSwitcher-1.2.4-r1a1-x86-gcc2-2009-09-06.zip
			: $(baseURL)/KeymapSwitcher-1.2.4-r1a1-x86-gcc2-2009-09-06.zip
			:
		;
		AddSymlinkToAntaresImage home config be Desktop\ applets
			: /boot/common/bin/KeymapSwitcher ;
	}
}


# LibIconv
if [ IsOptionalAntaresImagePackageAdded LibIconv ] {
	if $(TARGET_ARCH) != x86 {
		Echo "No optional package LibIconv available for $(TARGET_ARCH)" ;
	} else {
		InstallOptionalAntaresImagePackage libiconv-1.13.1-r1a1-x86-gcc2-2009-09-08.zip
			: $(baseURL)/libiconv-1.13.1-r1a1-x86-gcc2-2009-09-08.zip
			:
		;
	}
}


# LibLayout library
if [ IsOptionalAntaresImagePackageAdded LibLayout ] {
	if $(TARGET_ARCH) != x86 {
		Echo "No optional package LibLayout available for $(TARGET_ARCH)" ;
	} else if $(ANTARES_GCC_VERSION[1]) >= 4 && ! $(isHybridBuild) {
		Echo "No optional package LibLayout available for gcc4" ;
	} else {
		InstallOptionalAntaresImagePackage liblayout-1.4.0-gcc2-2009-03-08.zip
			: $(baseURL)/liblayout-1.4.0-gcc2-2009-03-08.zip
			:
		;
	}
}


# LibXML2
if [ IsOptionalAntaresImagePackageAdded LibXML2 ] {
	if $(TARGET_ARCH) != x86 {
		Echo "No optional package LibXML2 available for $(TARGET_ARCH)" ;
	} else {
		InstallOptionalAntaresImagePackage libxml2-2.7.6-x86-gcc2-2009-10-19.zip
			: $(baseURL)/libxml2-2.7.6-x86-gcc2-2009-10-19.zip
			:
			: true
		;
	}
}


# Links web browser
if [ IsOptionalAntaresImagePackageAdded Links ] {
	if $(TARGET_ARCH) != x86 {
		Echo "No optional package Links available for $(TARGET_ARCH)" ;
	} else if $(ANTARES_GCC_VERSION[1]) >= 4 && ! $(isHybridBuild) {
		Echo "No optional package Links available for gcc4" ;
	} else {
		InstallOptionalAntaresImagePackage Links.zip
			: $(baseURL)/links-x86-gcc2-2008-05-03.zip
			:
		;
		AddSymlinkToAntaresImage home config be Applications
			: /boot/home/config/bin/links ;
	}
}


# Mercurial
if [ IsOptionalAntaresImagePackageAdded Mercurial ] {
	if $(TARGET_ARCH) != x86 {
		Echo "No optional package Mercurial available for $(TARGET_ARCH)" ;
	} else {
		InstallOptionalAntaresImagePackage mercurial-1.3.1-r1a1-x86-gcc2-2009-08-30.zip
			: $(baseURL)/mercurial-1.3.1-r1a1-x86-gcc2-2009-08-30.zip
			:
			: true
		;
	}
}


# Nano
if [ IsOptionalAntaresImagePackageAdded Nano ] {
	if $(TARGET_ARCH) != x86 {
		Echo "No optional package Nano available for $(TARGET_ARCH)" ;
	} else {
		InstallOptionalAntaresImagePackage nano-2.0.9-r1a1-x86-gcc2-2009-08-30.zip
			: $(baseURL)/nano-2.0.9-r1a1-x86-gcc2-2009-08-30.zip
			:
		;
	}
}


# Neon
if [ IsOptionalAntaresImagePackageAdded Neon ] {
	if $(TARGET_ARCH) != x86 {
		Echo "No optional package Neon available for $(TARGET_ARCH)" ;
	} else {
		InstallOptionalAntaresImagePackage neon-0.29.3-x86-gcc2-2010-02-28.zip
			: $(baseURL)/neon-0.29.3-x86-gcc2-2010-02-28.zip
			:
			: true
		;
	}
}


# NetFS network file system
if [ IsOptionalAntaresImagePackageAdded NetFS ] {
	# userlandfs module
	AddFilesToAntaresImage home config add-ons userlandfs : netfs ;

	# servers
	AddFilesToAntaresImage system servers : netfs_server ;
	AddFilesToAntaresImage system servers : authentication_server ;

	# tools
	AddFilesToAntaresImage system bin : netfs_config ;
	AddFilesToAntaresImage system bin : netfs_server_prefs ;

	#example settings for netfs_server
	local netfsServerSettingsFiles = <driver-settings>netfs-server ;
	SEARCH on $(netfsServerSettingsFiles)
		= [ FDirName $(ANTARES_TOP) src add-ons kernel file_systems netfs ] ;
	AddFilesToAntaresImage home config settings kernel drivers
	: $(netfsServerSettingsFiles) ;

	#userlandfs settings are needed for netfs_config to work (ioctls)
	local userlandfsServerSettingsFiles = <driver-settings>userlandfs ;
	SEARCH on $(userlandfsServerSettingsFiles)
		= [ FDirName $(ANTARES_TOP) src add-ons kernel file_systems userlandfs ] ;
	AddFilesToAntaresImage home config settings kernel drivers
	: $(userlandfsServerSettingsFiles) ;
}


# NetSurf web browser
if [ IsOptionalAntaresImagePackageAdded NetSurf ] {
	if $(TARGET_ARCH) != x86 {
		Echo "No optional package NetSurf available for $(TARGET_ARCH)" ;
	} else if $(ANTARES_GCC_VERSION[1]) >= 4 && ! $(isHybridBuild) {
		Echo "No optional package NetSurf available for gcc4" ;
	} else {
		InstallOptionalAntaresImagePackage NetSurf-r9862b.zip
			: $(baseURL)/NetSurf-r9862-x86-gcc2-2010-01-27.zip
			:
		;
		AddSymlinkToAntaresImage home config be Applications
			: /boot/apps/netsurf/NetSurf ;
	}
}


# OCaml
if [ IsOptionalAntaresImagePackageAdded OCaml ] {
	if $(TARGET_ARCH) != x86 {
		Echo "No optional package OCaml available for $(TARGET_ARCH)" ;
	} else if $(ANTARES_GCC_VERSION[1]) >= 4 && ! $(isHybridBuild) {
		Echo "No optional package OCaml available for gcc4" ;
	} else {
		InstallOptionalAntaresImagePackage ocaml-3.11.1-r1a1-x86-gcc2-2009-09-06.zip
			: http://jerome.duval.free.fr/obos/ocaml-3.11.1-r1a1-x86-gcc2-2009-09-06.zip
			:
		;
		InstallOptionalAntaresImagePackage camlp5-5.12-r1a1-x86-gcc2-2009-09-06.zip
			: http://jerome.duval.free.fr/obos/camlp5-5.12-r1a1-x86-gcc2-2009-09-06.zip
			:
		;
	}
}


# OpenSound drivers
if [ IsOptionalAntaresImagePackageAdded OpenSound ] {
	if $(TARGET_ARCH) != x86 {
		Echo "No optional package OpenSound available for $(TARGET_ARCH)" ;
	} else {
		InstallOptionalAntaresImagePackage OpenSound.zip
			: $(baseURL)/OpenSound-x86-gcc2-2008-06-21.zip
			:
		;
	}
	#ExtractArchiveToAntaresImage home : data/vv.mp3.zip : 0 ;
}


# OpenSSH
if [ IsOptionalAntaresImagePackageAdded OpenSSH ] {
	if $(TARGET_ARCH) != x86 {
		Echo "No optional package OpenSSH available for $(TARGET_ARCH)" ;
	} else {
		if ! $(ANTARES_IMAGE_HOST_NAME) && ! $(ANTARES_IGNORE_USER_BUILD_CONFIG) {
			Exit "Optional package OpenSSH requires the ANTARES_IMAGE_HOST_NAME"
				"variable to be set!" ;
		}

		InstallOptionalAntaresImagePackage openssh-5.3p1-r1a1-x86-gcc2-2009-10-11.zip
			: $(baseURL)/openssh-5.3p1-r1a1-x86-gcc2-2009-10-11.zip
			:
		;

		AddUserToAntaresImage sshd : 1001 : 100 : /var/empty : /bin/true
			: "sshd user" ;
	}
}


# OpenSSL
if [ IsOptionalAntaresImagePackageAdded OpenSSL ] {
	if $(TARGET_ARCH) != x86 {
		Echo "No optional package OpenSSL available for $(TARGET_ARCH)" ;
	} else {
		InstallOptionalAntaresImagePackage $(ANTARES_OPENSSL_PACKAGE)
			: $(ANTARES_OPENSSL_URL)
			:
		;
	}
}


# P7zip
if [ IsOptionalAntaresImagePackageAdded P7zip ] {
	if $(TARGET_ARCH) != x86 {
		Echo "No optional package P7zip available for $(TARGET_ARCH)" ;
	} else {
		if $(ANTARES_GCC_VERSION[1]) >= 4 {
			InstallOptionalAntaresImagePackage p7zip-9.04-x86-gcc4-2009-10-25.zip
				: $(baseURL)/p7zip-9.04-x86-gcc4-2009-10-25.zip
				:
			;
		} else {
			InstallOptionalAntaresImagePackage p7zip-9.04-x86-gcc2-2009-10-25.zip
				: $(baseURL)/p7zip-9.04-x86-gcc2-2009-10-25.zip
				:
			;
		}
		AddExpanderRuleToAntaresImage "application/x-7z-compressed" : .7z
			: "7za l \\0045s"
			: "7za x -y \\0045s"
		;

	}
}


# PCRE regex engine
if [ IsOptionalAntaresImagePackageAdded PCRE ] {
	if $(TARGET_ARCH) != x86 {
		Echo "No optional package PCRE available for $(TARGET_ARCH)" ;
	} else {
		if $(ANTARES_GCC_VERSION[1]) >= 4 {
			InstallOptionalAntaresImagePackage pcre-7.9-x86-gcc4-2009-09-30.zip
				: $(baseURL)/pcre-7.9-x86-gcc4-2009-09-30.zip
			;
		} else {
			InstallOptionalAntaresImagePackage pcre-7.9-x86-gcc2-2009-09-30.zip
				: $(baseURL)/pcre-7.9-x86-gcc2-2009-09-30.zip
			;
		}
	}
}


# Pe text editor
if [ IsOptionalAntaresImagePackageAdded Pe ] {
	if $(TARGET_ARCH) != x86 {
		Echo "No optional package Pe available for $(TARGET_ARCH)" ;
	} else {
		if $(ANTARES_GCC_VERSION[1]) >= 4 {
			InstallOptionalAntaresImagePackage Pe-2.4.2-x86-gcc4-2009-08-04.zip
				: $(baseURL)/Pe-2.4.2-x86-gcc4-2009-08-04.zip
			;
		} else {
			InstallOptionalAntaresImagePackage Pe-2.4.2-r593-r1a1-x86-gcc2-2009-09-08.zip
				: $(baseURL)/Pe-2.4.2-r593-r1a1-x86-gcc2-2009-09-08.zip
			;
		}

		AddSymlinkToAntaresImage home config be Applications
			: /boot/apps/Pe/Pe ;
		AddSymlinkToAntaresImage common bin
			: /boot/apps/Pe/lpe ;
	}
}


# Perl
if [ IsOptionalAntaresImagePackageAdded Perl ] {
	if $(TARGET_ARCH) != x86 {
		Echo "No optional package Perl available for $(TARGET_ARCH)" ;
	} else {
		InstallOptionalAntaresImagePackage perl-5.10.1-r1a1-x86-gcc2-2009-09-08.zip
			: $(baseURL)/perl-5.10.1-r1a1-x86-gcc2-2009-09-08.zip
			:
			: true
		;
	}
}


# Python
if [ IsOptionalAntaresImagePackageAdded Python ] {
	if $(TARGET_ARCH) != x86 {
		Echo "No optional package Python available for $(TARGET_ARCH)" ;
	} else {
		InstallOptionalAntaresImagePackage python-2.6.4-x86-gcc2-2009-11-26.zip
			: $(baseURL)/python-2.6.4-x86-gcc2-2009-11-26.zip
			:
			: true
		;
	}
}


# Rsync
if [ IsOptionalAntaresImagePackageAdded Rsync ] {
	if $(TARGET_ARCH) != x86 {
		Echo "No optional package Rsync available for $(TARGET_ARCH)" ;
	} else {
		InstallOptionalAntaresImagePackage rsync-3.0.7-x86-gcc2-2010-01-05.zip
			: $(baseURL)/rsync-3.0.7-x86-gcc2-2010-01-05.zip
			:
		;
	}
}


# SQLite
if [ IsOptionalAntaresImagePackageAdded SQLite ] {
	if $(TARGET_ARCH) != x86 {
		Echo "No optional package SQLite available for $(TARGET_ARCH)" ;
	} else {
		InstallOptionalAntaresImagePackage sqlite-3.6.17-r1a1-x86-gcc2-2009-08-30.zip
			: $(baseURL)/sqlite-3.6.17-r1a1-x86-gcc2-2009-08-30.zip
			:
			: true
		;
	}
}


# Subversion
if [ IsOptionalAntaresImagePackageAdded Subversion ] {
	if $(TARGET_ARCH) != x86 {
		Echo "No optional package Subversion available for $(TARGET_ARCH)" ;
	} else {
		InstallOptionalAntaresImagePackage subversion-1.6.9-x86-gcc2-2010-03-01.zip
			: $(baseURL)/subversion-1.6.9-x86-gcc2-2010-03-01.zip
			:
			: true
		;
	}
}


# Tar
if [ IsOptionalAntaresImagePackageAdded Tar ] {
	if $(TARGET_ARCH) != x86 {
		Echo "No optional package Tar available for $(TARGET_ARCH)" ;
	} else {
		InstallOptionalAntaresImagePackage tar-1.22-x86-gcc4-2010-02-25.zip
			: $(baseURL)/tar-1.22-x86-gcc4-2010-02-25.zip
			:
		;
	}
}


# UserlandFS
if [ IsOptionalAntaresImagePackageAdded UserlandFS ] {
	local arch = $(TARGET_ARCH) ;
	local abi = gcc$(ANTARES_GCC_VERSION[1]) ;

	# kernel module
	AddFilesToAntaresImage system add-ons kernel file_systems : userlandfs ;

	# server
	AddFilesToAntaresImage system servers : userlandfs_server ;

	# libs
	local userlandfsLibs =
		libuserlandfs_beos_kernel.so
		libuserlandfs_antares_kernel.so
		libuserlandfs_fuse.so
	;
	AddFilesToAntaresHybridImage system lib : $(userlandfsLibs) : : true ;

	# development goodies
	if [ IsOptionalAntaresImagePackageAdded DevelopmentMin ] {
		if ! ( $(ANTARES_GCC_VERSION[1]) in 2 4 ) {
			Exit "Optional package UserlandFS: Unsupported GCC version:"
				$(ANTARES_GCC_VERSION[1]) ;
		}

		# library symlinks
		local lib ;
		for lib in $(userlandfsLibs) {
			AddSymlinkToAntaresImage develop abi $(arch) $(abi) lib
				: /system/lib/$(lib:BS) ;
			AddSymlinkToAlternativeGCCArchive develop abi $(arch) $(abi) lib
				: /system/lib/$(arch)/$(lib:BS) ;
		}

		# FUSE headers
		local fuseHeaders =
			fuse_common_compat.h
			fuse_common.h
			fuse_compat.h
			fuse.h
			fuse_lowlevel_compat.h
			fuse_lowlevel.h
			fuse_opt.h
		;
		fuseHeaders = $(fuseHeaders:G=userlandfs!fuse) ;
		SEARCH on $(fuseHeaders)
			= [ FDirName $(ANTARES_TOP) headers private userlandfs fuse ] ;
		AddFilesToAntaresImage develop headers userlandfs fuse : $(fuseHeaders) ;
	}
}


# Vim
if [ IsOptionalAntaresImagePackageAdded Vim ] {
	if $(TARGET_ARCH) != x86 {
		Echo "No optional package Vim available for $(TARGET_ARCH)" ;
	} else if $(ANTARES_GCC_VERSION[1]) >= 4 {
		InstallOptionalAntaresImagePackage vim-7.2-x86-gcc4-2009-05-31.zip
			:  $(baseURL)/vim-7.2-x86-gcc4-2009-05-31.zip
			:
		;
		AddSymlinkToAntaresImage home config be Applications
			: /boot/common/bin/gvim ;
	} else {
		InstallOptionalAntaresImagePackage vim-7.2-r1a1-x86-gcc2-2009-09-06.zip
			:  $(baseURL)/vim-7.2-r1a1-x86-gcc2-2009-09-06.zip
			:
		;
		AddSymlinkToAntaresImage home config be Applications
			: /boot/common/bin/gvim ;
	}
}


# Vision
if [ IsOptionalAntaresImagePackageAdded Vision ] {
	if $(TARGET_ARCH) != x86 {
		Echo "No optional package Vision available for $(TARGET_ARCH)" ;
	} else if $(ANTARES_GCC_VERSION[1]) >= 4 {
		InstallOptionalAntaresImagePackage Vision-0.9.7-H-090423-1.zip
			: $(baseURL)/Vision-0.9.7-H-x86-gcc4-2009-04-23.zip
			: apps
		;
		AddSymlinkToAntaresImage home config be Applications
			: /boot/apps/Vision-0.9.7-H-090423/Vision ;
	} else {
		InstallOptionalAntaresImagePackage Vision-0.9.7-H-090423.zip
			: $(baseURL)/Vision-0.9.7-H-x86-gcc2-2009-04-23.zip
			: apps
		;
		AddSymlinkToAntaresImage home config be Applications
			: /boot/apps/Vision-0.9.7-H-090423/Vision ;
	}
}


# VLC media player
if [ IsOptionalAntaresImagePackageAdded VLC ] {
	if $(TARGET_ARCH) != x86 {
		Echo "No optional package VLC available for $(TARGET_ARCH)" ;
	} else if $(ANTARES_GCC_VERSION[1]) >= 4 && ! $(isHybridBuild) {
		Echo "No optional package VLC available for gcc4" ;
	} else {
		InstallOptionalAntaresImagePackage VLC-0.8.6d.zip
			: $(baseURL)/vlc-0.8.6d-gcc2-2009-04-18.zip
			: apps
		;
		AddSymlinkToAntaresImage home config be Applications
			: "/boot/apps/vlc-0.8.6d/VLC media player" ;
		AddSymlinkToAntaresImage common bin
			: "/boot/apps/vlc-0.8.6d/VLC media player" : vlc ;
	}
}


# Welcome
if [ IsOptionalAntaresImagePackageAdded Welcome ] {
	CopyDirectoryToAntaresImage system documentation
		: [ FDirName $(ANTARES_TOP) docs welcome ]
		: welcome : -x .svn ;
	CopyDirectoryToAntaresImage system documentation
		: [ FDirName $(ANTARES_TOP) docs userguide ]
		: userguide : -x .svn ;
	CopyDirectoryToAntaresImage system documentation
		: [ FDirName $(ANTARES_TOP) docs images ]
		: images : -x .svn ;
	AddSymlinkToAntaresImage home Desktop
		: /boot/system/documentation/welcome/welcome_en.html : Welcome ;
	AddSymlinkToAntaresImage home Desktop
		: /boot/system/documentation/userguide/en/contents.html : User\ Guide ;
}


# WifiFirmwareScriptData
# This optional package is for people who build their own images & have wifi
# hardware that requires install-wifi-firmwares.sh & have no active network
# connection. This is not to be added to default images.
if [ IsOptionalAntaresImagePackageAdded WifiFirmwareScriptData ] {
	if $(TARGET_ARCH) != x86 {
		Echo "No optional package WifiFirmwareScriptData available for"
			$(TARGET_ARCH) ;
	} else {
		# broadcom43xx
		# firmware cutter
		local broadcomFWCutterArchive = b43-fwcutter-012.tar.bz2 ;
		local broadcomFWCutterURL =
			http://bu3sch.de/b43/fwcutter/$(broadcomFWCutterArchive) ;
		local broadcomFWCutterFile = [ DownloadFile $(broadcomFWCutterArchive)
			: $(broadcomFWCutterURL) ] ;
		AddFilesToAntaresImage system data firmware broadcom43xx b43-fwcutter
			: $(broadcomFWCutterFile) ;

		# headers needed to compile firmware cutter
		local glibcDir = [ FDirName
			$(ANTARES_TOP) src system libroot posix glibc ] ;
		local byteswapHeader = [ FDirName $(glibcDir) string byteswap.h ] ;
		AddFilesToAntaresImage system data firmware broadcom43xx b43-fwcutter
			: $(byteswapHeader) ;
		local bitByteswapHeader = [ FDirName
			$(glibcDir) include arch x86 bits byteswap.h ] ;
		AddFilesToAntaresImage system data firmware broadcom43xx b43-fwcutter bits
			: $(bitByteswapHeader) ;

		# file containing firmware
		local broadcom43xxFile ;
		broadcom43xxFile = [ DownloadFile wl_apsta-3.130.20.0.o
			: http://downloads.openwrt.org/sources/wl_apsta-3.130.20.0.o ] ;
		AddFilesToAntaresImage system data firmware broadcom43xx
			: $(broadcom43xxFile) ;

		# ipw2100
		local FirmwareTopDirectory = [ FDirName
			$(ANTARES_TOP) data system data firmware ] ;
		local ipw2100FWArchive = [ FDirName
			$(FirmwareTopDirectory) ipw2100 ipw2100-fw-1.3.tgz ] ;
		AddFilesToAntaresImage system data firmware ipw2100
			: $(ipw2100FWArchive) ;

		# iprowifi2200
		local FirmwareTopDirectory = [ FDirName
			$(ANTARES_TOP) data system data firmware ] ;
		local iprowifi2200FWArchive = [ FDirName
			$(FirmwareTopDirectory) iprowifi2200 ipw2200-fw-3.1.tgz ] ;
		AddFilesToAntaresImage system data firmware iprowifi2200
			: $(iprowifi2200FWArchive) ;

		# marvell88w8335
		local marvelArchive = malo-firmware-1.4.tgz ;
		local marvelURL = http://www.nazgul.ch/malo/$(marvelArchive) ;
		local marvelFile = [ DownloadFile $(marvelArchive) : $(marvelURL) ] ;
		AddFilesToAntaresImage system data firmware marvell88w8335
			: $(marvelFile) ;
	}
}


# WonderBrush
if [ IsOptionalAntaresImagePackageAdded WonderBrush ] {
	if $(TARGET_ARCH) != x86 {
		Echo "No optional package WonderBrush available for $(TARGET_ARCH)" ;
	} else if $(ANTARES_GCC_VERSION[1]) >= 4 && ! $(isHybridBuild) {
		Echo "No optional package WonderBrush available for gcc4" ;
	} else {
		InstallOptionalAntaresImagePackage WonderBrush-2.1.2.zip
			: $(baseURL)/WonderBrush-2.1.2-x86-gcc2-2008-11-08.zip
			: apps
		;
		AddSymlinkToAntaresImage home config be Applications
			: /boot/apps/WonderBrush/WonderBrush ;
	}
}


# XZ-Utils
if [ IsOptionalAntaresImagePackageAdded XZ-Utils ] {
	if $(TARGET_ARCH) != x86 {
		Echo "No optional package XZ-Utils available for $(TARGET_ARCH)" ;
	} else {
		InstallOptionalAntaresImagePackage xz-utils-4.999.9-x86-gcc4-2010-02-25.zip
			: $(baseURL)/xz-utils-4.999.9-x86-gcc4-2010-02-25.zip
			:
		;
		AddExpanderRuleToAntaresImage "application/x-xz" : .tar.xz
			: "tar -Jtvf \\0045s"
			: "tar -Jxvf \\0045s"
		;
		AddExpanderRuleToAntaresImage "application/x-xz" : .txz
			: "tar -Jtvf \\0045s"
			: "tar -Jxvf \\0045s"
		;
		AddExpanderRuleToAntaresImage "application/x-xz" : .xz
			: "echo \\0045s | sed 's/.xz\\\$//g'"
			: "xz -df \\0045s"
		;
	}
}


# Yasm
if [ IsOptionalAntaresImagePackageAdded Yasm ] {
	if $(TARGET_ARCH) != x86 {
		Echo "No optional package Yasm available for $(TARGET_ARCH)" ;
	} else {
		InstallOptionalAntaresImagePackage yasm-0.8.0-r1a1-x86-gcc2-2009-08-30.zip
			: $(baseURL)/yasm-0.8.0-r1a1-x86-gcc2-2009-08-30.zip
			:
		;
	}
}
